#include "lut.h"

#include "main.h"
#include "global.h"

// memopt
const static int _div_lut[] = {
0x7fffffff, 0x00010000, 0x00008000, 0x00005555, 0x00004000, 0x00003333, 0x00002aaa, 0x00002492, 
0x00002000, 0x00001c71, 0x00001999, 0x00001745, 0x00001555, 0x000013b1, 0x00001249, 0x00001111, 
0x00001000, 0x00000f0f, 0x00000e38, 0x00000d79, 0x00000ccc, 0x00000c30, 0x00000ba2, 0x00000b21,
0x00000aaa, 0x00000a3d, 0x000009d8, 0x0000097b, 0x00000924, 0x000008d3, 0x00000888, 0x00000842,
0x00000800, 0x000007c1, 0x00000787, 0x00000750, 0x0000071c, 0x000006eb, 0x000006bc, 0x00000690,
0x00000666, 0x0000063e, 0x00000618, 0x000005f4, 0x000005d1, 0x000005b0, 0x00000590, 0x00000572,
0x00000555, 0x00000539, 0x0000051e, 0x00000505, 0x000004ec, 0x000004d4, 0x000004bd, 0x000004a7,
0x00000492, 0x0000047d, 0x00000469, 0x00000456, 0x00000444, 0x00000432, 0x00000421, 0x00000410,
0x00000400, 0x000003f0, 0x000003e0, 0x000003d2, 0x000003c3, 0x000003b5, 0x000003a8, 0x0000039b,
0x0000038e, 0x00000381, 0x00000375, 0x00000369, 0x0000035e, 0x00000353, 0x00000348, 0x0000033d,
0x00000333, 0x00000329, 0x0000031f, 0x00000315, 0x0000030c, 0x00000303, 0x000002fa, 0x000002f1,
0x000002e8, 0x000002e0, 0x000002d8, 0x000002d0, 0x000002c8, 0x000002c0, 0x000002b9, 0x000002b1,
0x000002aa, 0x000002a3, 0x0000029c, 0x00000295, 0x0000028f, 0x00000288, 0x00000282, 0x0000027c,
0x00000276, 0x00000270, 0x0000026a, 0x00000264, 0x0000025e, 0x00000259, 0x00000253, 0x0000024e,
0x00000249, 0x00000243, 0x0000023e, 0x00000239, 0x00000234, 0x00000230, 0x0000022b, 0x00000226,
0x00000222, 0x0000021d, 0x00000219, 0x00000214, 0x00000210, 0x0000020c, 0x00000208, 0x00000204,
0x00000200, 0x000001fc, 0x000001f8, 0x000001f4, 0x000001f0, 0x000001ec, 0x000001e9, 0x000001e5,
0x000001e1, 0x000001de, 0x000001da, 0x000001d7, 0x000001d4, 0x000001d0, 0x000001cd, 0x000001ca,
0x000001c7, 0x000001c3, 0x000001c0, 0x000001bd, 0x000001ba, 0x000001b7, 0x000001b4, 0x000001b2,
0x000001af, 0x000001ac, 0x000001a9, 0x000001a6, 0x000001a4, 0x000001a1, 0x0000019e, 0x0000019c,
0x00000199, 0x00000197, 0x00000194, 0x00000192, 0x0000018f, 0x0000018d, 0x0000018a, 0x00000188,
0x00000186, 0x00000183, 0x00000181, 0x0000017f, 0x0000017d, 0x0000017a, 0x00000178, 0x00000176,
0x00000174, 0x00000172, 0x00000170, 0x0000016e, 0x0000016c, 0x0000016a, 0x00000168, 0x00000166, 
0x00000164, 0x00000162, 0x00000160, 0x0000015e, 0x0000015c, 0x0000015a, 0x00000158, 0x00000157,
0x00000155, 0x00000153, 0x00000151, 0x00000150, 0x0000014e, 0x0000014c, 0x0000014a, 0x00000149,
0x00000147, 0x00000146, 0x00000144, 0x00000142, 0x00000141, 0x0000013f, 0x0000013e, 0x0000013c,
0x0000013b, 0x00000139, 0x00000138, 0x00000136, 0x00000135, 0x00000133, 0x00000132, 0x00000130,
0x0000012f, 0x0000012e, 0x0000012c, 0x0000012b, 0x00000129, 0x00000128, 0x00000127, 0x00000125,
0x00000124, 0x00000123, 0x00000121, 0x00000120, 0x0000011f, 0x0000011e, 0x0000011c, 0x0000011b,
0x0000011a, 0x00000119, 0x00000118, 0x00000116, 0x00000115, 0x00000114, 0x00000113, 0x00000112,
0x00000111, 0x0000010f, 0x0000010e, 0x0000010d, 0x0000010c, 0x0000010b, 0x0000010a, 0x00000109,
0x00000108, 0x00000107, 0x00000106, 0x00000105, 0x00000104, 0x00000103, 0x00000102, 0x00000101
};

IWRAM_CODE static inline int lookup_div(int x) {
    x >>= 8;
    if (x > 0xFF)
        x = 0xFF;
    
    return _div_lut[x];
}

// b min value is 256
IWRAM_CODE inline int fastdiv(int a, int b) {
    return a * lookup_div(b) >> FP_SHIFT;
}

// memopt
const static int _sin_lut[] = {
0x00000028, 0x0000008d, 0x000000f1, 0x00000156, 0x000001ba, 0x0000021e, 0x00000281, 0x000002e4, 
0x00000347, 0x000003a9, 0x0000040a, 0x0000046b, 0x000004cc, 0x0000052b, 0x0000058a, 0x000005e8, 
0x00000645, 0x000006a1, 0x000006fc, 0x00000756, 0x000007ae, 0x00000806, 0x0000085c, 0x000008b1,
0x00000905, 0x00000957, 0x000009a8, 0x000009f8, 0x00000a46, 0x00000a92, 0x00000adc, 0x00000b25,
0x00000b6d, 0x00000bb2, 0x00000bf6, 0x00000c38, 0x00000c78, 0x00000cb6, 0x00000cf2, 0x00000d2c,
0x00000d64, 0x00000d9a, 0x00000dce, 0x00000dff, 0x00000e2f, 0x00000e5c, 0x00000e88, 0x00000eb1,
0x00000ed7, 0x00000efc, 0x00000f1e, 0x00000f3d, 0x00000f5b, 0x00000f76, 0x00000f8f, 0x00000fa5,
0x00000fb9, 0x00000fca, 0x00000fd9, 0x00000fe6, 0x00000ff0, 0x00000ff7, 0x00000ffc, 0x00000fff
};

IWRAM_CODE inline int fastsin(int x) {
    x >>= 4;
    x &= 0xFF;

    int i = x & 63;
    if ((x & 64) != 0)
        i = 63 - i;

    int res = _sin_lut[i];

    if ((x & 128) != 0)
        res = -res;

    return res;
}

IWRAM_CODE inline int fastcos(int x) {
  return fastsin(x + 1024);
}
